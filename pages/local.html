<!DOCTYPE html>
<html lang="en" style="height: 100%">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" type="image/x-icon" href="../img/favicon.ico" />
    <title>Weather Kitty Demo</title>
    <!-- prettier-ignore -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet@1.5.1/dist/leaflet.css" />
    <!-- prettier-ignore -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet-timedimension@1.1.1/dist/leaflet.timedimension.control.min.css" />

    <link rel="stylesheet" href="styles.css" />
  </head>

  <body id="WeatherKittyBody" style="height: 100%">
    <header id="WeatherKittyHeader">
      <div id="HeaderRow1">
        <div>
          <img id="LogoImg" src="../img/Logo128.png" alt="Angle Hornet Logo" />
        </div>
        <div id="NavImg">
          <img src="../img/CatBurger.png" alt="Hamburger Image" />
          <nav id="HamLinks">
            <a id="HamToHome" href="../"><span>Home</span></a>
            <!-- <a id="HamWeather"><span>Weather Charts</span></a>
            <a id="HamHistory"><span>History Charts</span></a>
            <a id="HamClimate"><span>Boston Climate Charts</span></a>
            <hr style="width: 0.33em; margin: 0.33em; align-self: center; justify-self: center" /> -->
            <a id="HamExpire"><span>Expire ttl</span></a>
            <a id="HamPurge"><span>Purge Cache</span></a>
            <!-- <a id="HamTest"><span>Run Tests</span></a> -->
          </nav>
        </div>

        <div id="HeaderTitle">
          <h1>Weather Kitty Demo</h1>
          <weather-kitty-geoaddress> </weather-kitty-geoaddress>
        </div>
        <div id="WeatherKittyWidgetDiv">
          <!-- <weather-kitty></weather-kitty> -->
        </div>
      </div>
      <div id="HeaderRow2">
        <nav id="NavLinks">
          <a id="NavToHome" href="../"><span>Home</span></a>
          <!--<a id="NavWeather"><span>Weather Charts</span></a>
          <a id="NavHistory"><span>History Charts</span></a>
          <a id="NavClimate"><span>Boston Climate Charts</span></a>
          <hr style="width: 0.33em; margin: 0.33em; align-self: center; justify-self: center" /> -->
          <a id="NavExpire"><span>Expire ttl</span></a>
          <a id="NavPurge"><span>Purge Cache</span></a>
          <!-- <a id="NavTest"><span>Run Tests</span></a> -->
        </nav>
        <weather-kitty-status> </weather-kitty-status>
        <weather-kitty-geoaddress> </weather-kitty-geoaddress>
      </div>
    </header>

    <main id="WeatherKittyMain">
      <div style="border: red 1px solid; margin: 3px; height: 100%; overflow: auto">
        <p class="HelpText"><strong>Leaflet</strong> - NWS WMS</p>

        <!-- // ------------------------------------------------------------------------ -->
        <!-- // ------------------------------------------------------------------------ -->
        <!-- // ------------------------------------------------------------------------ -->
        <div
          id="map"
          style="height: 80vh; width: 80vw; margin: 10vh 10vw; border: black 3px solid"
        ></div>
      </div>
    </main>

    <footer id="WeatherKittyFooter"><p>&copy; 2024 Angel Hornet.</p></footer>

    <!-- // ------------------------------------------------------------------------ -->

    <!-- // ------------------------------------------------------------------------ -->

    <!-- // ------------------------------------------------------------------------ -->

    <script type="module">
      import { corsCache } from "../src/fetchCache.mjs";

      // get the nws ridgeII radar map for KJKL
      // Image is about -4.3degE wide x 3.95degN high
      // Coordinates are about 4.3 wide x 3.6 high
      // I'm calculating closer to 4wide and 3.6 high
      // Hickory, NC is about 35.7343, -81.3445
      // Jackson, KY is about 37.5536, -83.3102
      // Franklin Co, IN is about 39.2683, -85.2966

      let width = 4.3;
      let height = 3.95;

      let localRadar = "KJKL";
      let bottom = 35.5;
      let right = -81.0;

      let CacheTime = 1000 * 60 * 30; // 5 minutes
      let localRefresh = new Date().getTime() / CacheTime;
      let radarUrl = `https://radar.weather.gov/ridge/standard/${localRadar}_loop.gif?refreshed=${localRefresh}`;

      let response = await corsCache(radarUrl, null, CacheTime);

      if (response != null && response.ok) {
        let blob = await response.blob();
        let url = URL.createObjectURL(blob);

        let map = document.getElementById("map");

        let img = new Image();
        img.src = url;
        img.style.width = "100%";
        img.style.height = "100%";
        map.appendChild(img);
      }
    </script>
  </body>
</html>
